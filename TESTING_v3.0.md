# v3.0 功能测试指南

## 测试日期
2025-10-24

---

## 1. 新布局测试 ✅

### 测试步骤
1. 创建一个能力或选择现有能力
2. 进入"阶段辅导"
3. 验证布局：
   - ✅ 左侧显示"当前方案"面板
   - ✅ 右侧显示对话区域
   - ✅ 头部显示日期和删除按钮
   - ✅ 左侧显示进度信息（第X天 / 共Y天）
   - ✅ 左侧显示所有阶段和任务

### 预期结果
```
┌─────────────────────────────────────────┐
│  ← 返回    阶段辅导    10月24日  🗑️ 删除  │
├───────────────┬─────────────────────────┤
│ 📋 当前方案   │   对话消息区域          │
│              │                         │
│ 第3天 / 共21天│   💬 对话内容...         │
│              │                         │
│ 总天数: 21天  │                         │
│ 已完成: 3天   │   [输入框]             │
│              │   [发送]               │
│ 阶段1: ...    │                         │
│ 阶段2: ...    │                         │
│              │                         │
│ [讨论修改方案]│                         │
└───────────────┴─────────────────────────┘
```

---

## 2. AI对话流程测试 ✅

### 测试场景：调整学习计划

#### 步骤1：用户提出需求
```
用户输入："我想调整计划"
```

**预期AI回复：**
```
好的，我先了解一下情况。你觉得现在的计划有什么问题吗？
是节奏太快、太慢，还是内容不太合适？
```

#### 步骤2：用户说明问题
```
用户输入："感觉太快了，想多花点时间"
```

**预期AI回复：**
```
理解你的感受。具体是哪个阶段让你觉得太快了？
或者说，你希望在哪方面多花些时间？
```

#### 步骤3：用户详细说明
```
用户输入："第二阶段需要更多时间，可以延长到40天吗"
```

**预期AI回复：**
```
根据你的反馈，我建议这样调整：

原方案：21天，3个阶段
新方案：40天，3个阶段

主要改变：
• 第二阶段从7天延长到20天，让你有更多时间深入练习
• 第三阶段也稍微延长，确保巩固效果

这样调整后，你会感觉轻松很多。看看左侧预览的新方案，觉得怎么样？

[PROPOSE_PLAN]{...}[/PROPOSE_PLAN]
```

**预期界面变化：**
- ✅ 左侧方案面板变成黄色预览样式
- ✅ 显示"新方案预览"标识
- ✅ 显示"第3天 / 共40天"（进度保持）
- ✅ 显示新的阶段划分
- ✅ 系统消息提示如何确认

#### 步骤4：用户确认
```
用户输入："好的，就按这个来吧"
```

**预期AI回复：**
```
太好了！新方案已经应用，明天开始生效。

✅ 调整完成：
• 总天数：21天 → 40天
• 当前进度：第3天 / 共40天
• 你的进度保持不变，只是有更充裕的时间了

学习是个过程，不用着急。按自己的节奏来就好！加油！💪

[CONFIRM_PLAN][/CONFIRM_PLAN]
```

**预期界面变化：**
- ✅ 左侧方案面板恢复正常样式
- ✅ 显示更新后的方案
- ✅ 进度显示：第3天 / 共40天
- ✅ 系统消息确认调整完成
- ✅ 主页、个人中心同步更新

---

## 3. 进度保持测试 ✅

### 测试用例

#### 场景1：从21天延长到40天
```
初始状态：
- 当前进度：第3天 / 共21天
- 已打卡：2天

调整后：
- 当前进度：第3天 / 共40天  ✅ 正确
- 已打卡：2天  ✅ 正确

❌ 错误示例：第1天 / 共40天（进度被重置）
```

#### 场景2：从30天缩短到25天
```
初始状态：
- 当前进度：第5天 / 共30天

调整后：
- 当前进度：第5天 / 共25天  ✅ 正确
```

### 验证点
1. ✅ `ability.currentDay` 保持不变
2. ✅ `ability.totalDays` 更新为新值
3. ✅ 所有显示位置同步更新
4. ✅ `ability.planAdjustments` 记录调整历史

---

## 4. 删除辅导记录测试 ✅

### 测试步骤
1. 进入辅导对话页面
2. 点击头部的"🗑️ 删除记录"按钮
3. 查看确认对话框
4. 点击"确定"

### 预期结果
```
弹窗内容：
⚠️ 确认删除此辅导记录？

删除后，本次辅导的所有对话记录将被永久删除。

[取消] [确定]
```

**点击确定后：**
- ✅ 辅导记录被删除
- ✅ 返回辅导列表页
- ✅ 列表中不再显示该记录
- ✅ 数据已保存

---

## 5. 昵称修改测试 ✅

### 测试步骤
1. 进入个人中心
2. 找到"基本信息"区域
3. 点击昵称旁的"✏️ 编辑"按钮
4. 输入新昵称（例如："小明"）
5. 确认

### 预期结果
**修改前：**
```
昵称：朋友  [✏️ 编辑]
```

**点击编辑后弹出输入框：**
```
请输入新昵称：[朋友        ]
               [确定] [取消]
```

**修改后：**
- ✅ 个人中心显示：昵称：小明
- ✅ 主页显示：你好，小明！
- ✅ 辅导对话中AI称呼变为"小明"
- ✅ 弹出提示：✅ 昵称已更新！

---

## 6. 主页昵称显示测试 ✅

### 测试步骤
1. 设置昵称为"小李"
2. 返回主页

### 预期结果
```
主页顶部：
┌─────────────────────────┐
│         👤             │
│    你好，小李！         │
│   [📊 个人中心]         │
└─────────────────────────┘
```

**默认情况（未设置昵称）：**
```
你好，朋友！
```

---

## 7. 全局数据同步测试 ✅

### 测试场景
用户在辅导页面将计划从21天调整为35天

### 需要验证的位置

#### 1. 主页 - 能力卡片
```
✅ 显示：第3天 / 35天
✅ 进度条：8.57%（3/35）
✅ 状态：进行中
```

#### 2. 个人中心 - 能力记录
```
✅ 总天数：35天
✅ 当前进度：第3天
✅ 完成率：8.57%
```

#### 3. 辅导页面 - 左侧面板
```
✅ 第3天 / 共35天
✅ 总天数：35天
✅ 已完成：3天
✅ 完成率：8%
```

#### 4. 任务页面
```
✅ 总天数：35天
✅ 当前第3天
✅ 时间轴正确显示
```

---

## 8. 响应式布局测试

### 桌面端（宽度 > 1024px）
```
✅ 左右分栏显示
✅ 左侧方案固定宽度400px
✅ 右侧对话区域自适应
```

### 平板端（宽度 < 1024px）
```
✅ 上下布局
✅ 方案面板在上，最大高度400px
✅ 对话面板在下，最小高度500px
```

### 手机端（宽度 < 480px）
```
✅ 头部按钮换行显示
✅ 标题左对齐
✅ 其他元素堆叠显示
```

---

## 9. 边界情况测试

### 情况1：天数范围验证
```
测试输入：15天
预期：❌ 失败，提示"天数必须在21-90天之间"

测试输入：100天
预期：❌ 失败，提示"天数必须在21-90天之间"

测试输入：30天
预期：✅ 成功
```

### 情况2：方案JSON验证
```
阶段days总和 ≠ totalDays
预期：AI应确保一致性

phases数组为空
预期：AI应至少生成2个阶段
```

### 情况3：没有提议方案就确认
```
用户直接说："确认"
预期：AI回复普通对话，不触发[CONFIRM_PLAN]
```

---

## 10. 完整流程测试

### 从零开始的完整旅程

1. **注册**
   - 输入昵称："测试用户"
   - ✅ 主页显示："你好，测试用户！"

2. **开始访谈**
   - 选择"能力访谈"
   - 完成3轮对话
   - 填写问卷
   - 继续对话
   - 生成方案

3. **首次打卡**
   - 进入任务页面
   - 当前：第1天 / 共21天
   - 完成小问题
   - 提交打卡
   - ✅ 当前：第2天 / 共21天

4. **调整计划**
   - 进入阶段辅导
   - 提出调整："太快了，想延长"
   - AI询问详情（2-3轮）
   - AI提议新方案（30天）
   - 左侧预览新方案
   - 确认应用
   - ✅ 当前：第2天 / 共30天

5. **修改昵称**
   - 进入个人中心
   - 修改昵称为："小王"
   - ✅ 主页更新："你好，小王！"

6. **继续打卡**
   - 返回任务页面
   - ✅ 当前：第2天 / 共30天
   - 完成第2天打卡
   - ✅ 当前：第3天 / 共30天

7. **查看个人中心**
   - 昵称：小王
   - 能力记录：1个
   - 进度：第3天 / 30天
   - 已打卡：2天
   - 辅导次数：1次

---

## 11. 控制台日志检查

### 正常日志输出
```
AI原始回复: ...
检测到提议方案: {"totalDays":35,...}
方案已保存，等待用户确认
✅ 新方案已应用
```

### 错误日志（不应出现）
```
❌ currentDay未定义
❌ planData解析失败
❌ 能力数据丢失
```

---

## 12. 数据持久性测试

### 测试步骤
1. 调整计划：21天 → 35天（当前第3天）
2. 刷新页面
3. 检查数据

### 预期结果
```
✅ 主页显示：第3天 / 35天
✅ 辅导页面显示：第3天 / 共35天
✅ 方案调整历史被保存
✅ 辅导对话历史被保存
✅ proposedPlan被清除（应用后）
```

---

## 总结

### 核心改进 ✅
1. ✅ 左右分栏UI
2. ✅ 先问后答的AI流程
3. ✅ 进度保持逻辑
4. ✅ 全局数据同步
5. ✅ 删除辅导记录
6. ✅ 昵称编辑
7. ✅ 主页昵称显示

### 技术要点 ✅
1. ✅ `PROPOSE_PLAN` - 提议方案（不立即应用）
2. ✅ `CONFIRM_PLAN` - 确认应用方案
3. ✅ `ability.currentDay` - 保持不变
4. ✅ `ability.proposedPlan` - 临时存储
5. ✅ `refreshAllViews()` - 全局同步

### 用户体验 ✅
1. ✅ 方案可视化预览
2. ✅ 充分沟通后再调整
3. ✅ 进度不丢失
4. ✅ 实时反馈
5. ✅ 二次确认保护

---

## 测试清单

在发布前，请确保完成以下测试：

- [ ] 新布局在不同屏幕尺寸下显示正常
- [ ] AI对话流程完整（询问→提议→确认）
- [ ] 进度在调整后保持不变
- [ ] 删除辅导记录功能正常
- [ ] 昵称编辑功能正常
- [ ] 主页昵称显示正常
- [ ] 所有页面数据同步
- [ ] 刷新页面后数据不丢失
- [ ] 控制台无错误日志
- [ ] 响应式布局正常

---

## 已知问题

目前没有已知问题 ✅

---

## 下一步优化建议

1. 方案历史对比功能
2. 方案调整次数统计
3. 辅导会话导出功能
4. 更丰富的数据可视化
5. 方案调整原因记录（用户输入）



